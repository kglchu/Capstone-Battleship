var Battleship=Battleship||{};Battleship.GameState=Battleship.GameState||{},Battleship.GameState.SHOT_DELAY=200,Battleship.GameState.BULLET_SPEED=850,Battleship.GameState.NUMBER_OF_BULLETS=20,Battleship.GameState.BOARD_COLS,Battleship.GameState.BOARD_ROWS,Battleship.GameState.CELL_SIZE=64,Battleship.GameState.CELL_SPACING=2,Battleship.GameState.CELL_SIZE_SPACED=Battleship.GameState.CELL_SIZE+Battleship.GameState.CELL_SPACING,Battleship.GameState.lastBulletShotAt=void 0,Battleship.GameState.cells,Battleship.GameState.selectedCell=null,Battleship.GameState.selectedCellStartPos={x:0,y:0},Battleship.GameState.levels={},Battleship.GameState.ship2={},Battleship.GameState.ship3={},Battleship.GameState.ship4={},Battleship.GameState.ship5={},Battleship.GameState.ship6={},Battleship.GameState.gameOver=!1,Battleship.GameState.init=function(){this.game.physics.startSystem(Phaser.Physics.ARCADE)},Battleship.GameState.preload=function(){this.load.image("bullet","img/assets/gfx/rocket.png"),this.load.image("player","img/assets/gfx/bullet.png"),this.load.image("enemy","img/assets/gfx/player.png"),this.load.image("ground","img/assets/gfx/ground.png"),this.load.image("ship2","img/assets/gfx/Ship2.png"),this.load.image("ship3","img/assets/gfx/Ship3.png"),this.load.image("ship4","img/assets/gfx/Ship4.png"),this.load.image("ship5","img/assets/gfx/Ship5.png"),this.load.image("ship6","img/assets/gfx/Ship6.png"),this.load.spritesheet("explosion","img/assets/gfx/explosion.png",128,128),this.load.spritesheet("cell","img/assets/gfx/cells.png",64,64)},Battleship.GameState.positionData=function(){this.matrix=[[0,0,0,0,0,0,0,0,2,2],[0,5,5,5,5,5,0,0,0,0],[0,0,0,6,0,0,0,0,0,0],[0,0,0,6,0,0,0,0,0,0],[0,0,0,6,0,0,0,0,0,0],[0,3,0,6,0,0,0,0,0,0],[0,3,0,6,0,0,0,0,0,0],[0,3,0,6,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,4,4,4,4,0,0,0]],this.levels.ships=[{ship2:{angle:0},ship3:{angle:90},ship4:{angle:0},ship5:{angle:0},ship6:{angle:90}}]},Battleship.GameState.create=function(){this.game.stage.backgroundColor="#4488cc",this.positionData(),this.spawnBoard(),this.gun=this.game.add.sprite(this.game.width/2,this.game.height-10,"player"),this.gun.anchor.setTo(.5,.5),this.bulletPool=this.game.add.group();for(var t=0;t<this.NUMBER_OF_BULLETS;t++){var s=this.game.add.sprite(0,0,"bullet");this.bulletPool.add(s),s.anchor.setTo(.5,.5),this.game.physics.enable(s,Phaser.Physics.ARCADE),s.kill()}this.game.input.activePointer.x=this.game.width/2,this.game.input.activePointer.y=this.game.height/2,this.explosionGroup=this.game.add.group()},Battleship.GameState.enemyHit=function(t){t.hasEnemy=!1,t.frame=1,console.log("enemy found!")},Battleship.GameState.sunkEnemyBattleship=function(t){switch(t.enemyContact){case 2:this.cells.ship2+=t.enemyContact,4===this.cells.ship2&&(this.ship2.location.visible=!0);break;case 3:this.cells.ship3+=t.enemyContact,9===this.cells.ship3&&(this.ship3.location.visible=!0);break;case 4:this.cells.ship4+=t.enemyContact,16===this.cells.ship4&&(this.ship4.location.visible=!0);break;case 5:this.cells.ship5+=t.enemyContact,25===this.cells.ship5&&(this.ship5.location.visible=!0);break;case 6:this.cells.ship6+=t.enemyContact,36===this.cells.ship6&&(this.ship6.location.visible=!0)}},Battleship.GameState.miss=function(t){t.frame=2,console.log("nothing here")},Battleship.GameState.shootBullet=function(){if(void 0===this.lastBulletShotAt&&(this.lastBulletShotAt=0),!(this.game.time.now-this.lastBulletShotAt<this.SHOT_DELAY)){this.lastBulletShotAt=this.game.time.now;var t=this.bulletPool.getFirstDead();null!==t&&void 0!==t&&(t.revive(),t.checkWorldBounds=!0,t.outOfBoundsKill=!0,t.reset(this.gun.x,this.gun.y),t.rotation=this.gun.rotation,t.body.velocity.x=Math.cos(t.rotation)*this.BULLET_SPEED,t.body.velocity.y=Math.sin(t.rotation)*this.BULLET_SPEED)}},Battleship.GameState.update=function(){this.GameOver(),this.game.physics.arcade.collide(this.bulletPool,this.cells,function(t,s){console.log("cell x: "+s.posX+" cell y: "+s.posY),t.kill(),s.hasEnemy?(this.getExplosion(s,s.posX,s.posY),this.enemyHit(s),this.sunkEnemyBattleship(s),this.gameOver&&(this.cells.forEach(function(t){t.frame=0},this),this.gun.destroy(),this.ship2.location.destroy(),this.ship3.location.destroy(),this.ship4.location.destroy(),this.ship5.location.destroy(),this.ship6.location.destroy(),this.create())):this.miss(s),s.body.enable&&(s.body.enable=!1)},null,this),this.gun.rotation=this.game.physics.arcade.angleToPointer(this.gun)},Battleship.GameState.getExplosion=function(t,s,i){var e=this.explosionGroup.getFirstDead();if(null===e){e=this.game.add.sprite(0,0,"explosion"),e.anchor.setTo(.5,.5);e.animations.add("boom",[0,0,1,2,3],60,!1).killOnComplete=!0,this.explosionGroup.add(e)}return e.revive(),e.x=s,e.y=i,e.angle=this.game.rnd.integerInRange(0,360),e.animations.play("boom"),e},Battleship.GameState.spawnBoard=function(){this.BOARD_COLS=Math.floor(this.game.world.width/this.CELL_SIZE_SPACED),this.BOARD_ROWS=Math.floor(this.game.world.height/this.CELL_SIZE_SPACED-1),this.cells=this.game.add.group(),this.cells.ship2=0,this.cells.ship3=0,this.cells.ship4=0,this.cells.ship5=0,this.cells.ship6=0,this.ship2.placed=!1,this.ship3.placed=!1,this.ship4.placed=!1,this.ship5.placed=!1,this.ship6.placed=!1;for(var t=0;t<this.BOARD_COLS;t++)for(var s=0;s<this.BOARD_ROWS;s++){var i=this.cells.create(t*this.CELL_SIZE_SPACED+this.CELL_SIZE_SPACED/2+2,s*this.CELL_SIZE_SPACED+this.CELL_SIZE/2+2,"cell",0);i.anchor.setTo(.5,.5),i.name="cell: "+t.toString()+"x"+s.toString(),i.inputEnabled=!0,i.enemyContact=0,i.marker=this.matrix[s][t],this.shipPlacement(i,i.marker),i.posX=i.x,i.posY=i.y,i.hasEnemy=i.marker>0,i.events.onInputDown.add(this.selectCell,this),i.events.onInputUp.add(this.releaseCell,this)}},Battleship.GameState.shipPlacement=function(t,s){switch(s){case 2:!0!==this.ship2.placed&&(90===this.levels.ships[0].ship2.angle?this.ship2.location=this.game.add.sprite(t.x+32,t.y-32,"ship2"):0===this.levels.ships[0].ship2.angle&&(this.ship2.location=this.game.add.sprite(t.x-32,t.y-32,"ship2")),this.ship2.location.angle=this.levels.ships[0].ship2.angle,this.ship2.location.visible=!1,this.ship2.placed=!0);break;case 3:!0!==this.ship3.placed&&(90===this.levels.ships[0].ship3.angle?this.ship3.location=this.game.add.sprite(t.x+32,t.y-32,"ship3"):0===this.levels.ships[0].ship3.angle&&(this.ship3.location=this.game.add.sprite(t.x-32,t.y-32,"ship3")),this.ship3.location.angle=this.levels.ships[0].ship3.angle,this.ship3.location.visible=!1,this.ship3.placed=!0);break;case 4:!0!==this.ship4.placed&&(90===this.levels.ships[0].ship4.angle?this.ship4.location=this.game.add.sprite(t.x+32,t.y-32,"ship4"):0===this.levels.ships[0].ship4.angle&&(this.ship4.location=this.game.add.sprite(t.x-32,t.y-32,"ship4")),this.ship4.location.angle=this.levels.ships[0].ship4.angle,this.ship4.location.visible=!1,this.ship4.placed=!0);break;case 5:!0!==this.ship5.placed&&(90===this.levels.ships[0].ship5.angle?this.ship5.location=this.game.add.sprite(t.x+32,t.y-32,"ship5"):0===this.levels.ships[0].ship5.angle&&(this.ship5.location=this.game.add.sprite(t.x-32,t.y-32,"ship5")),this.ship5.location.angle=this.levels.ships[0].ship5.angle,this.ship5.location.visible=!1,this.ship5.placed=!0);break;case 6:!0!==this.ship6.placed&&(90===this.levels.ships[0].ship6.angle?this.ship6.location=this.game.add.sprite(t.x+32,t.y-32,"ship6"):0===this.levels.ships[0].ship6.angle&&(this.ship6.location=this.game.add.sprite(t.x-32,t.y-32,"ship6")),this.ship6.location.angle=this.levels.ships[0].ship6.angle,this.ship6.location.visible=!1,this.ship6.placed=!0)}},Battleship.GameState.selectCell=function(t){this.shootBullet(),this.game.physics.enable(t,Phaser.Physics.ARCADE),t.body.immovable=!0,t.body.allowGravity=!1,t.hasEnemy&&(t.enemyContact=t.marker,t.marker=0,console.log("found enemy"))},Battleship.GameState.releaseCell=function(t){},Battleship.GameState.GameOver=function(){var t={},s=0;t=this.cells.children;for(var i=0;i<t.length;i++)s+=t[i].marker;this.gameOver=s<=0},Battleship.game=new Phaser.Game(664,730,Phaser.AUTO,"game-canvas"),Battleship.game.state.add("GameState",Battleship.GameState),Battleship.game.state.start("GameState");